From 0207f7f49dc10ebb31c3a4ad8993b49898df6fd9 Mon Sep 17 00:00:00 2001
From: Gatt <gatt@gatt.space>
Date: Tue, 25 Aug 2020 20:20:23 +1000
Subject: [PATCH] fix blockdrop event


diff --git a/src/main/java/net/minecraft/server/PlayerInteractManager.java b/src/main/java/net/minecraft/server/PlayerInteractManager.java
index e66c7a69b..4fb24b946 100644
--- a/src/main/java/net/minecraft/server/PlayerInteractManager.java
+++ b/src/main/java/net/minecraft/server/PlayerInteractManager.java
@@ -4,6 +4,8 @@ package net.minecraft.server;
 import net.gravitas.bandiadpaper.events.blocks.BlockBreakDropItemsEvent;
 import net.gravitas.bandiadpaper.events.blocks.BlockPreBreakEvent;
 import org.bukkit.Bukkit;
+import org.bukkit.Location;
+import org.bukkit.block.BlockState;
 import org.bukkit.craftbukkit.inventory.CraftItemStack;
 import org.bukkit.event.block.BlockBreakEvent;
 import org.bukkit.craftbukkit.event.CraftEventFactory;
@@ -349,7 +351,10 @@ public class PlayerInteractManager {
             }
 
             this.world.a(this.player, 2001, blockposition, Block.getCombinedId(iblockdata));
-            boolean flag = this.c(blockposition);
+            org.bukkit.Material blockType = block.getType();
+            BlockState state = block.getState();
+            Location blockLocation = block.getLocation();
+            boolean flag = this.c(blockposition); // sets the block to air
 
             if (this.isCreative()) {
                 this.player.playerConnection.sendPacket(new PacketPlayOutBlockChange(this.world, blockposition));
@@ -372,8 +377,7 @@ public class PlayerInteractManager {
                         List<org.bukkit.inventory.ItemStack> bukkitItemDrops = new ArrayList<>();
                         for (ItemStack dI : droppedItems) bukkitItemDrops.add(CraftItemStack.asBukkitCopy(dI));
 
-                        BlockBreakDropItemsEvent blockBreakDropItemsEvent = new BlockBreakDropItemsEvent(block, player.getBukkitEntity().getPlayer(),
-                                bukkitItemDrops, EnchantmentManager.hasSilkTouchEnchantment(player));
+                        BlockBreakDropItemsEvent blockBreakDropItemsEvent = new BlockBreakDropItemsEvent(block, blockLocation, blockType, state, player.getBukkitEntity(), bukkitItemDrops, EnchantmentManager.hasSilkTouchEnchantment(player));
 
                         this.world.getServer().getPluginManager().callEvent(blockBreakDropItemsEvent);
 
-- 
2.24.1.windows.2

